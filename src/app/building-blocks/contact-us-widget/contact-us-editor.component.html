<div class="contact-us-editor">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <div class="p-fluid contact-us-form-wrapper">
        <div class="row g-3">
            <div class="col-12 col-md-6">
                <div class="p-field mb-3">
                    <label for="title">Widget Title</label>
                    <input id="title" type="text" pInputText [(ngModel)]="settings.title" placeholder="Get In Touch" />
                </div>
            </div>
            <div class="col-12 col-md-6">
                <div class="p-field mb-3">
                    <label for="subtitle">Subtitle (Optional)</label>
                    <input id="subtitle" type="text" pInputText [(ngModel)]="settings.subtitle" placeholder="We'd love to hear from you" />
                </div>
            </div>
            <div class="col-12">
                <div class="p-field-checkbox mb-4">
                    <p-checkbox [(ngModel)]="settings.showContactForm" [binary]="true" inputId="showForm"></p-checkbox>
                    <label for="showForm" class="ms-2">
                        <strong>Show Contact Form</strong>
                        <small class="d-block text-muted">Enable a contact form where visitors can send messages directly</small>
                    </label>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <h3>Branches</h3>
            <p-table [value]="branches" [tableStyle]="{ 'min-width': '0', 'width': '100%' }" responsiveLayout="stack" [breakpoint]="'768px'">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th style="width: 8rem"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-branch let-rowIndex="rowIndex">
                    <tr>
                        <td>{{ branch.name }}</td>
                        <td>{{ branch.address }}</td>
                        <td>{{ branch.phone }}</td>
                        <td>{{ branch.email }}</td>
                        <td>
                            <div class="flex align-items-center gap-2">
                                <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text" (click)="editBranch(branch, rowIndex)"></button>
                                <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="deleteBranch(rowIndex)"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="empty">
                    <tr>
                        <td colspan="5">No branches added.</td>
                    </tr>
                </ng-template>
            </p-table>
            <button pButton label="Add Branch" icon="pi pi-plus" class="mt-3 w-100 w-md-auto" (click)="openNewBranch()"></button>
        </div>

        <div class="card mt-4">
            <h3>Social Media Handles</h3>
            <p-table [value]="socialMediaHandles" [tableStyle]="{ 'min-width': '0', 'width': '100%' }" responsiveLayout="stack" [breakpoint]="'768px'">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Platform</th>
                        <th>URL</th>
                        <th style="width: 8rem"></th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-handle let-rowIndex="rowIndex">
                    <tr>
                        <td>{{ handle.platform }}</td>
                        <td>{{ handle.url }}</td>
                        <td>
                            <div class="flex align-items-center gap-2">
                                <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text" (click)="editSocialMedia(handle, rowIndex)"></button>
                                <button pButton icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="deleteSocialMedia(rowIndex)"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="empty">
                    <tr>
                        <td colspan="3">No social media handles added.</td>
                    </tr>
                </ng-template>
            </p-table>
            <button pButton label="Add Social Media" icon="pi pi-plus" class="mt-3 w-100 w-md-auto" (click)="openNewSocialMedia()"></button>
        </div>
        <!-- Save button at the end -->
        <div class="mt-4 d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-success" (click)="saveSettings()">
                <i class="pi pi-check me-2"></i>Save Changes
            </button>
        </div>
    </div>

    <p-dialog header="Branch Details" [(visible)]="displayBranchDialog" [modal]="true" [style]="{ 'width': '90vw', 'max-width': '600px' }">
        <div class="p-fluid">
            <div class="p-field">
                <label for="branchName">Name</label>
                <input id="branchName" type="text" pInputText [(ngModel)]="branch.name" required />
            </div>
            <div class="p-field">
                <label for="branchAddress">Address</label>
                <input id="branchAddress" type="text" pInputText [(ngModel)]="branch.address" required />
            </div>
            <div class="p-field">
                <label for="branchPhone">Phone</label>
                <input id="branchPhone" type="text" pInputText [(ngModel)]="branch.phone" />
            </div>
            <div class="p-field">
                <label for="branchEmail">Email</label>
                <input id="branchEmail" type="text" pInputText [(ngModel)]="branch.email" />
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Cancel" icon="pi pi-times" (click)="displayBranchDialog = false" class="p-button-text"></p-button>
            <p-button label="Save" icon="pi pi-check" (click)="saveBranch()"></p-button>
        </ng-template>
    </p-dialog>

    <p-dialog header="Social Media Details" [(visible)]="displaySocialMediaDialog" [modal]="true" [style]="{ 'width': '90vw', 'max-width': '600px' }">
        <div class="p-fluid">
            <div class="p-field">
                <label for="platform">Platform</label>
                <input id="platform" type="text" pInputText [(ngModel)]="socialMedia.platform" required />
            </div>
            <div class="p-field">
                <label for="url">URL</label>
                <input id="url" type="text" pInputText [(ngModel)]="socialMedia.url" required />
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Cancel" icon="pi pi-times" (click)="displaySocialMediaDialog = false" class="p-button-text"></p-button>
            <p-button label="Save" icon="pi pi-check" (click)="saveSocialMedia()"></p-button>
        </ng-template>
    </p-dialog>
</div>
