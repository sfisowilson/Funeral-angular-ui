<div class="page-builder-container">
    <!-- Toolbar -->
    <div class="builder-toolbar">
        <div class="toolbar-left">
            <h2 class="toolbar-title">
                <i class="pi pi-sitemap"></i>
                Landing Page Builder
            </h2>
        </div>
        
        <div class="toolbar-actions">
            <button 
                pButton 
                type="button"
                icon="pi pi-plus"
                label="Add Widget"
                class="btn-primary-theme"
                (click)="openWidgetPicker()">
            </button>
            
            <button 
                pButton 
                type="button"
                icon="pi pi-search"
                label="SEO Settings"
                class="btn-outline-secondary-theme"
                (click)="openSeoSettings()"
                pTooltip="Manage meta tags and SEO">
            </button>
            
            <button 
                pButton 
                type="button"
                [icon]="gridVisible() ? 'pi pi-eye-slash' : 'pi pi-eye'"
                [label]="gridVisible() ? 'Hide Grid' : 'Show Grid'"
                class="btn-outline-primary-theme"
                (click)="toggleGrid()">
            </button>
            
            <button 
                pButton 
                type="button"
                icon="pi pi-arrows-v"
                label="Compact"
                class="btn-outline-primary-theme"
                (click)="compactLayout()"
                pTooltip="Remove empty spaces">
            </button>
            
            <button 
                pButton 
                type="button"
                icon="pi pi-refresh"
                label="Reset Page"
                class="btn-outline-danger-theme"
                (click)="resetPage()"
                pTooltip="Remove all widgets and reset theme">
            </button>
            
            <button 
                pButton 
                type="button"
                [icon]="previewMode() ? 'pi pi-pencil' : 'pi pi-eye'"
                [label]="previewMode() ? 'Edit Mode' : 'Preview'"
                [class]="previewMode() ? 'btn-outline-primary-theme' : 'btn-primary-theme'"
                (click)="togglePreview()">
            </button>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="builder-content" [class.preview-mode]="previewMode()">
        <!-- Canvas -->
        <div class="builder-canvas" [class.show-grid]="gridVisible() && !previewMode()">
            <div 
                class="widget-grid"
                [ngStyle]="getGridStyles()"
                cdkDropList
                (cdkDropListDropped)="onWidgetDrop($event)">
                
                <div 
                    *ngFor="let widget of widgets(); let i = index; trackBy: trackByWidgetId"
                    class="widget-item"
                    [class.selected]="selectedWidget()?.id === widget.id"
                    [class.preview-mode]="previewMode()"
                    [ngStyle]="getWidgetStyles(widget)"
                    cdkDrag>
                    
                    <!-- Widget Controls (Edit Mode Only) -->
                    <div *ngIf="!previewMode()" class="widget-controls">
                        <div class="control-handle" cdkDragHandle>
                            <i class="pi pi-arrows-alt"></i>
                        </div>
                        
                        <div class="control-buttons">
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-pencil"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="editWidgetContent(widget)"
                                pTooltip="Edit Content">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-cog"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="selectWidget(widget)"
                                pTooltip="Layout Settings">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-clone"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="duplicateWidget(widget)"
                                pTooltip="Duplicate">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-arrow-up"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="moveWidgetUp(widget)"
                                pTooltip="Move Up">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-arrow-down"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="moveWidgetDown(widget)"
                                pTooltip="Move Down">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-arrows-h"
                                class="btn-rounded btn-outline-primary-theme btn-sm"
                                (click)="setWidgetFullWidth(widget)"
                                pTooltip="Full Width">
                            </button>
                            <button 
                                pButton 
                                type="button"
                                icon="pi pi-trash"
                                class="btn-rounded btn-outline-danger-theme btn-sm"
                                (click)="deleteWidget(widget)"
                                pTooltip="Delete">
                            </button>
                        </div>
                        
                        <div class="widget-type-badge">
                            {{ widget.type }}
                        </div>
                    </div>
                    
                    <!-- Widget Content -->
                    <div class="widget-content">
                        <ng-container *ngComponentOutlet="getWidgetComponent(widget.type); inputs: { config: widget }">
                        </ng-container>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div *ngIf="widgets().length === 0" class="empty-state">
                    <i class="pi pi-inbox"></i>
                    <h3>No Widgets Yet</h3>
                    <p>Click "Add Widget" to start building your landing page</p>
                    <button 
                        pButton 
                        type="button"
                        label="Add Your First Widget"
                        icon="pi pi-plus"
                        (click)="openWidgetPicker()">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Widget Picker Dialog -->
    <p-dialog 
        [(visible)]="showWidgetPicker"
        header="Add Widget"
        [modal]="true"
        [style]="{ width: '800px' }"
        [draggable]="false"
        [resizable]="false">
        
        <div class="widget-picker-grid">
            <div 
                *ngFor="let widgetType of availableWidgets"
                class="widget-picker-item"
                (click)="addWidget(widgetType)">
                <div class="widget-icon">
                    <i [class]="'pi pi-' + widgetType.icon"></i>
                </div>
                <h4>{{ widgetType.name | titlecase }}</h4>
            </div>
        </div>
    </p-dialog>

    <!-- Layout Settings Dialog -->
    <p-dialog 
        [(visible)]="showLayoutSettings"
        header="Widget Layout Settings"
        [modal]="true"
        [style]="{ width: '600px' }"
        [draggable]="false"
        [resizable]="false"
        [closable]="false">
        <ng-template pTemplate="header">
            <div class="d-flex justify-content-between align-items-center w-100">
                <span>Widget Layout Settings</span>
                <button type="button" class="btn-close" aria-label="Close" (click)="showLayoutSettings.set(false)"></button>
            </div>
        </ng-template>
        
        <div *ngIf="selectedWidget()" class="layout-settings">
            <p-tabView>
                <!-- Position & Size Tab -->
                <p-tabPanel header="Position & Size" leftIcon="pi pi-map">
                    <div class="settings-section">
                        <h4>Grid Position</h4>
                        
                        <div class="form-field">
                            <label>Column</label>
                            <p-inputNumber 
                                [(ngModel)]="selectedWidget()!.layout!.column"
                                [min]="1"
                                [max]="gridColumns()"
                                [showButtons]="true">
                            </p-inputNumber>
                        </div>
                        
                        <div class="form-field">
                            <label>Row</label>
                            <p-inputNumber 
                                [(ngModel)]="selectedWidget()!.layout!.row"
                                [min]="1"
                                [showButtons]="true">
                            </p-inputNumber>
                        </div>
                        
                        <div class="form-field">
                            <label>Column Span (Width)</label>
                            <p-dropdown 
                                [(ngModel)]="selectedWidget()!.layout!.columnSpan"
                                [options]="columnSpanOptions"
                                optionLabel="label"
                                optionValue="value"
                                [style]="{ width: '100%' }">
                            </p-dropdown>
                        </div>
                        
                        <div class="form-field">
                            <label>Row Span (Height)</label>
                            <p-dropdown 
                                [(ngModel)]="selectedWidget()!.layout!.rowSpan"
                                [options]="rowSpanOptions"
                                optionLabel="label"
                                optionValue="value"
                                [style]="{ width: '100%' }"
                                [disabled]="!!selectedWidget()!.layout!.autoHeight">
                            </p-dropdown>
                        </div>
                        
                        <div class="form-field">
                            <p-checkbox 
                                [(ngModel)]="selectedWidget()!.layout!.autoHeight"
                                [binary]="true"
                                label="Auto Height (Adapts to content)"
                                inputId="autoHeight">
                            </p-checkbox>
                            <small class="text-gray-600 block mt-1">
                                Recommended for dynamic content like calculators and forms
                            </small>
                        </div>
                        
                        <div class="form-field">
                            <p-checkbox 
                                [(ngModel)]="selectedWidget()!.layout!.fullWidth"
                                [binary]="true"
                                label="Full Width"
                                inputId="fullWidth">
                            </p-checkbox>
                            <small class="text-gray-600 block mt-1">
                                Stretch widget to span entire width of the page
                            </small>
                        </div>
                    </div>
                </p-tabPanel>
                
                <!-- Styling Tab -->
                <p-tabPanel header="Styling" leftIcon="pi pi-palette">
                    <div class="settings-section">
                        <h4>Spacing</h4>
                        
                        <!-- Padding Controls -->
                        <div class="form-field">
                            <div class="flex justify-content-between align-items-center mb-2">
                                <label class="mb-0">Padding</label>
                                <p-checkbox 
                                    [(ngModel)]="paddingIndividual"
                                    [binary]="true"
                                    label="Individual Sides"
                                    inputId="paddingIndividual">
                                </p-checkbox>
                            </div>
                            
                            <div *ngIf="!paddingIndividual">
                                <label class="text-sm text-gray-600">All Sides ({{ selectedWidget()!.layout!.padding || 0 }}px)</label>
                                <p-slider 
                                    [(ngModel)]="selectedWidget()!.layout!.padding"
                                    (ngModelChange)="onPaddingAllChange($event)"
                                    [min]="0"
                                    [max]="100">
                                </p-slider>
                            </div>
                            
                            <div *ngIf="paddingIndividual" class="grid grid-cols-2 gap-3 mt-2">
                                <div>
                                    <label class="text-sm text-gray-600">Top ({{ selectedWidget()!.layout!.paddingTop ?? selectedWidget()!.layout!.padding ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.paddingTop"
                                        [min]="0"
                                        [max]="100">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Right ({{ selectedWidget()!.layout!.paddingRight ?? selectedWidget()!.layout!.padding ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.paddingRight"
                                        [min]="0"
                                        [max]="100">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Bottom ({{ selectedWidget()!.layout!.paddingBottom ?? selectedWidget()!.layout!.padding ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.paddingBottom"
                                        [min]="0"
                                        [max]="100">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Left ({{ selectedWidget()!.layout!.paddingLeft ?? selectedWidget()!.layout!.padding ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.paddingLeft"
                                        [min]="0"
                                        [max]="100">
                                    </p-slider>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Margin Controls -->
                        <div class="form-field mt-4">
                            <div class="flex justify-content-between align-items-center mb-2">
                                <label class="mb-0">Margin</label>
                                <p-checkbox 
                                    [(ngModel)]="marginIndividual"
                                    [binary]="true"
                                    label="Individual Sides"
                                    inputId="marginIndividual">
                                </p-checkbox>
                            </div>
                            
                            <div *ngIf="!marginIndividual">
                                <label class="text-sm text-gray-600">All Sides ({{ selectedWidget()!.layout!.margin || 0 }}px)</label>
                                <p-slider 
                                    [(ngModel)]="selectedWidget()!.layout!.margin"
                                    (ngModelChange)="onMarginAllChange($event)"
                                    [min]="0"
                                    [max]="50">
                                </p-slider>
                            </div>
                            
                            <div *ngIf="marginIndividual" class="grid grid-cols-2 gap-3 mt-2">
                                <div>
                                    <label class="text-sm text-gray-600">Top ({{ selectedWidget()!.layout!.marginTop ?? selectedWidget()!.layout!.margin ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.marginTop"
                                        [min]="0"
                                        [max]="50">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Right ({{ selectedWidget()!.layout!.marginRight ?? selectedWidget()!.layout!.margin ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.marginRight"
                                        [min]="0"
                                        [max]="50">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Bottom ({{ selectedWidget()!.layout!.marginBottom ?? selectedWidget()!.layout!.margin ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.marginBottom"
                                        [min]="0"
                                        [max]="50">
                                    </p-slider>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-600">Left ({{ selectedWidget()!.layout!.marginLeft ?? selectedWidget()!.layout!.margin ?? 0 }}px)</label>
                                    <p-slider 
                                        [(ngModel)]="selectedWidget()!.layout!.marginLeft"
                                        [min]="0"
                                        [max]="50">
                                    </p-slider>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="mt-4">Dimensions</h4>
                        
                        <div class="form-field">
                            <label>Minimum Height (px)</label>
                            <p-inputNumber 
                                [(ngModel)]="selectedWidget()!.layout!.minHeight"
                                [min]="0"
                                [step]="10">
                            </p-inputNumber>
                        </div>
                        
                        <div class="form-field">
                            <label>Maximum Height (px)</label>
                            <p-inputNumber 
                                [(ngModel)]="selectedWidget()!.layout!.maxHeight"
                                [min]="0"
                                [step]="10">
                            </p-inputNumber>
                        </div>
                        
                        <h4 class="mt-4">Appearance</h4>
                        
                        <div class="form-field">
                            <label>Background Color</label>
                            <input 
                                type="color" 
                                [(ngModel)]="selectedWidget()!.layout!.backgroundColor"
                                class="color-input">
                        </div>
                        
                        <div class="form-field">
                            <label>Border Radius ({{ selectedWidget()!.layout!.borderRadius || 0 }}px)</label>
                            <p-slider 
                                [(ngModel)]="selectedWidget()!.layout!.borderRadius"
                                [min]="0"
                                [max]="50">
                            </p-slider>
                        </div>
                        
                        <div class="form-field">
                            <label>Z-Index (Layer)</label>
                            <p-inputNumber 
                                [(ngModel)]="selectedWidget()!.layout!.zIndex"
                                [min]="0"
                                [max]="100">
                            </p-inputNumber>
                        </div>
                    </div>
                </p-tabPanel>
                
                <!-- Responsive Tab -->
                <p-tabPanel header="Responsive" leftIcon="pi pi-mobile">
                    <div class="settings-section">
                        <p class="text-sm text-gray-600 mb-4">
                            Configure how this widget appears on different devices
                        </p>
                        
                        <p-panel header="Mobile" [toggleable]="true" [collapsed]="true">
                            <div class="form-field">
                                <label>Column Span</label>
                                <p-inputNumber 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.mobile!.columnSpan"
                                    [min]="1"
                                    [max]="12">
                                </p-inputNumber>
                            </div>
                            <div class="form-field">
                                <p-checkbox 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.mobile!.hidden"
                                    [binary]="true"
                                    label="Hide on Mobile"
                                    inputId="hideMobile">
                                </p-checkbox>
                            </div>
                        </p-panel>
                        
                        <p-panel header="Tablet" [toggleable]="true" [collapsed]="true" class="mt-3">
                            <div class="form-field">
                                <label>Column Span</label>
                                <p-inputNumber 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.tablet!.columnSpan"
                                    [min]="1"
                                    [max]="12">
                                </p-inputNumber>
                            </div>
                            <div class="form-field">
                                <p-checkbox 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.tablet!.hidden"
                                    [binary]="true"
                                    label="Hide on Tablet"
                                    inputId="hideTablet">
                                </p-checkbox>
                            </div>
                        </p-panel>
                        
                        <p-panel header="Desktop" [toggleable]="true" [collapsed]="true" class="mt-3">
                            <div class="form-field">
                                <label>Column Span</label>
                                <p-inputNumber 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.desktop!.columnSpan"
                                    [min]="1"
                                    [max]="12">
                                </p-inputNumber>
                            </div>
                            <div class="form-field">
                                <p-checkbox 
                                    [(ngModel)]="selectedWidget()!.layout!.responsive!.desktop!.hidden"
                                    [binary]="true"
                                    label="Hide on Desktop"
                                    inputId="hideDesktop">
                                </p-checkbox>
                            </div>
                        </p-panel>
                    </div>
                </p-tabPanel>
                
                <!-- Animations Tab -->
                <p-tabPanel header="Animations" leftIcon="pi pi-sparkles">
                    <div class="settings-section">
                        <div class="form-field">
                            <p-checkbox 
                                [(ngModel)]="selectedWidget()!.layout!.animationEnabled"
                                [binary]="true"
                                label="Enable Animations"
                                inputId="animationEnabled">
                            </p-checkbox>
                            <small class="text-gray-600 block mt-1">
                                Animations add visual interest when widgets appear
                            </small>
                        </div>
                        
                        <ng-container *ngIf="selectedWidget()!.layout!.animationEnabled">
                            <div class="form-field">
                                <label>Animation Type</label>
                                <p-dropdown 
                                    [(ngModel)]="selectedWidget()!.layout!.animationType"
                                    [options]="animationTypeOptions"
                                    optionLabel="label"
                                    optionValue="value"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                            </div>
                            
                            <div class="form-field">
                                <label>Duration ({{ selectedWidget()!.layout!.animationDuration || 600 }}ms)</label>
                                <p-slider 
                                    [(ngModel)]="selectedWidget()!.layout!.animationDuration"
                                    [min]="200"
                                    [max]="2000"
                                    [step]="100">
                                </p-slider>
                                <small class="text-gray-600">
                                    Faster (200ms) to Slower (2000ms)
                                </small>
                            </div>
                            
                            <div class="form-field">
                                <label>Delay ({{ selectedWidget()!.layout!.animationDelay || 0 }}ms)</label>
                                <p-inputNumber 
                                    [(ngModel)]="selectedWidget()!.layout!.animationDelay"
                                    [min]="0"
                                    [max]="5000"
                                    [step]="100"
                                    suffix="ms">
                                </p-inputNumber>
                                <small class="text-gray-600">
                                    Wait time before animation starts
                                </small>
                            </div>
                            
                            <div class="form-field">
                                <label>Easing</label>
                                <p-dropdown 
                                    [(ngModel)]="selectedWidget()!.layout!.animationEasing"
                                    [options]="animationEasingOptions"
                                    optionLabel="label"
                                    optionValue="value"
                                    [style]="{ width: '100%' }">
                                </p-dropdown>
                                <small class="text-gray-600">
                                    Animation timing curve
                                </small>
                            </div>
                            
                            <div class="animation-preview">
                                <p class="text-sm font-semibold mb-2">Preview:</p>
                                <div class="preview-box" 
                                     [class]="'animate-' + (selectedWidget()!.layout!.animationType || 'fade-in')"
                                     [style.animation-duration.ms]="selectedWidget()!.layout!.animationDuration || 600"
                                     [style.animation-timing-function]="selectedWidget()!.layout!.animationEasing || 'ease'">
                                    Widget Animation
                                </div>
                            </div>
                        </ng-container>
                        
                        <h4 class="mt-4">Hover Effects</h4>
                        
                        <div class="form-field">
                            <label>Hover Effect</label>
                            <p-dropdown 
                                [(ngModel)]="selectedWidget()!.layout!.hoverEffect"
                                [options]="hoverEffectOptions"
                                optionLabel="label"
                                optionValue="value"
                                [style]="{ width: '100%' }">
                            </p-dropdown>
                            <small class="text-gray-600">
                                Interactive effect when user hovers over widget
                            </small>
                        </div>
                        
                        <div class="info-box mt-4">
                            <i class="pi pi-info-circle"></i>
                            <div>
                                <strong>Accessibility Note:</strong> Users who prefer reduced motion won't see these animations.
                            </div>
                        </div>
                    </div>
                </p-tabPanel>
            </p-tabView>
        </div>
        
        <ng-template pTemplate="footer">
            <div class="py-4 d-flex flex-row justify-items-end">
                <button 
                    type="button"
                    class="btn btn-outline-secondary me-2"
                    (click)="showLayoutSettings.set(false)">
                    <i class="pi pi-times me-1"></i> Cancel
                </button>
                <button 
                    type="button"
                    class="btn-primary-theme"
                    (click)="updateWidgetLayout(); showLayoutSettings.set(false)">
                    <i class="pi pi-check me-1"></i> Apply
                </button>
            </div>
        </ng-template>
    </p-dialog>
    
    <!-- Widget Content Editor Dialog -->
    <p-dialog 
        [(visible)]="showContentEditor"
        [header]="'Edit ' + (selectedWidget()?.type || 'Widget') + ' Content'"
        [modal]="true"
        [style]="{ width: '90vw', maxWidth: '1000px', minHeight: '500px' }"
        [draggable]="false"
        [resizable]="false"
        [contentStyle]="{ 'overflow-y': 'auto' }"
        styleClass="content-editor-dialog">
        
        <div class="content-editor" *ngIf="selectedWidget()">
            <ng-container #editorContainer></ng-container>
        </div>
    </p-dialog>

    <!-- SEO Settings Dialog -->
    <p-dialog 
        [(visible)]="showSeoSettings"
        header="SEO & Meta Tags Settings"
        [modal]="true"
        [style]="{ width: '800px' }"
        [draggable]="false"
        [resizable]="false"
        styleClass="seo-settings-dialog">
        
        <div class="seo-settings-form">
            <div class="field">
                <label for="pageTitle">Page Title *</label>
                <input 
                    type="text" 
                    pInputText 
                    id="pageTitle" 
                    [(ngModel)]="seoSettings().pageTitle"
                    placeholder="e.g., Complete Funeral Service Platform - Online in Minutes"
                    class="w-full"
                    maxlength="60" />
                <small class="text-muted">Recommended: 50-60 characters. Appears in browser tab and search results.</small>
            </div>

            <div class="field">
                <label for="metaDescription">Meta Description *</label>
                <textarea 
                    pInputTextarea 
                    id="metaDescription" 
                    [(ngModel)]="seoSettings().metaDescription"
                    placeholder="e.g., Professional website and comprehensive management system for funeral service providers. No technical knowledge required."
                    class="w-full"
                    rows="3"
                    maxlength="160"></textarea>
                <small class="text-muted">Recommended: 150-160 characters. Appears in search engine results.</small>
            </div>

            <div class="field">
                <label for="metaKeywords">Meta Keywords</label>
                <input 
                    type="text" 
                    pInputText 
                    id="metaKeywords" 
                    [(ngModel)]="seoSettings().metaKeywords"
                    placeholder="e.g., funeral service, funeral management, burial society, funeral home"
                    class="w-full" />
                <small class="text-muted">Comma-separated keywords. Optional for most search engines.</small>
            </div>

            <div class="field">
                <label for="canonicalUrl">Canonical URL</label>
                <input 
                    type="url" 
                    pInputText 
                    id="canonicalUrl" 
                    [(ngModel)]="seoSettings().canonicalUrl"
                    placeholder="https://yourname.funeral.com"
                    class="w-full" />
                <small class="text-muted">Preferred URL for this page (helps prevent duplicate content issues).</small>
            </div>

            <p-divider align="left">
                <span class="text-lg font-semibold">Social Media (Open Graph)</span>
            </p-divider>

            <div class="field">
                <label for="ogTitle">Open Graph Title</label>
                <input 
                    type="text" 
                    pInputText 
                    id="ogTitle" 
                    [(ngModel)]="seoSettings().ogTitle"
                    placeholder="Leave empty to use Page Title"
                    class="w-full"
                    maxlength="60" />
                <small class="text-muted">Title shown when shared on Facebook, LinkedIn, etc.</small>
            </div>

            <div class="field">
                <label for="ogDescription">Open Graph Description</label>
                <textarea 
                    pInputTextarea 
                    id="ogDescription" 
                    [(ngModel)]="seoSettings().ogDescription"
                    placeholder="Leave empty to use Meta Description"
                    class="w-full"
                    rows="2"
                    maxlength="200"></textarea>
                <small class="text-muted">Description shown when shared on social media.</small>
            </div>

            <div class="field">
                <label for="ogImage">Open Graph Image URL</label>
                <input 
                    type="url" 
                    pInputText 
                    id="ogImage" 
                    [(ngModel)]="seoSettings().ogImage"
                    placeholder="https://yourname.funeral.com/images/og-image.jpg"
                    class="w-full" />
                <small class="text-muted">Image shown when shared (recommended: 1200x630px).</small>
            </div>

            <div class="field">
                <label for="twitterCard">Twitter Card Type</label>
                <p-dropdown 
                    id="twitterCard"
                    [(ngModel)]="seoSettings().twitterCard"
                    [options]="[
                        { label: 'Summary with Large Image', value: 'summary_large_image' },
                        { label: 'Summary', value: 'summary' },
                        { label: 'App', value: 'app' },
                        { label: 'Player', value: 'player' }
                    ]"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Select Twitter card type"
                    class="w-full"></p-dropdown>
                <small class="text-muted">Format for Twitter/X posts.</small>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <div class="py-4 d-flex flex-row justify-items-end">
                <button 
                    pButton 
                    type="button"
                    label="Cancel"
                    icon="pi pi-times"
                    class="btn-outline-secondary-theme"
                    (click)="cancelSeoSettings()">
                </button>
                <button 
                    pButton 
                    type="button"
                    label="Save SEO Settings"
                    icon="pi pi-check"
                    class="btn-primary-theme"
                    (click)="saveSeoSettings()">
                </button>
            </div>
        </ng-template>
    </p-dialog>

    <!-- Post-Reset Modal (Bootstrap) -->
    <div class="modal fade" 
         [class.show]="showPostResetDialog()" 
         [style.display]="showPostResetDialog() ? 'block' : 'none'"
         [style.background]="showPostResetDialog() ? 'rgba(0,0,0,0.5)' : 'transparent'"
         tabindex="-1" 
         [attr.aria-hidden]="!showPostResetDialog()">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Start Fresh</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-arrow-clockwise text-primary" style="font-size: 3rem;"></i>
                        <h3 class="mt-3">Your page has been reset!</h3>
                        <p class="text-muted">How would you like to start building your landing page?</p>
                    </div>
                    
                    <div class="d-grid gap-3">
                        <button type="button" 
                                class="btn btn-outline-primary w-100"
                                (click)="startWithBlankPage()">
                            <i class="bi bi-file-earmark me-2"></i>
                            Start with Blank Page
                            <small class="d-block text-muted">Build everything from scratch</small>
                        </button>
                        
                        <button type="button" 
                                class="btn btn-outline-primary w-100"
                                (click)="selectTheme()">
                            <i class="bi bi-palette me-2"></i>
                            Select a Theme
                            <small class="d-block text-muted">Choose a pre-designed theme</small>
                        </button>
                        
                        <button type="button" 
                                class="btn btn-outline-primary w-100"
                                (click)="loadTemplate()">
                            <i class="bi bi-stack me-2"></i>
                            Use a Template
                            <small class="d-block text-muted">Start with a complete template</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Selection Modal (Bootstrap) -->
    <div class="modal fade" 
         [class.show]="showTemplateDialog()" 
         [style.display]="showTemplateDialog() ? 'block' : 'none'"
         [style.background]="showTemplateDialog() ? 'rgba(0,0,0,0.5)' : 'transparent'"
         tabindex="-1" 
         [attr.aria-hidden]="!showTemplateDialog()">
        <div class="modal-dialog modal-lg" style="max-width: 900px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select a Template</h5>
                    <button type="button" 
                            class="btn-close" 
                            (click)="cancelTemplateSelection()"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 60vh; overflow-y: auto;">
                    <div class="mb-4">
                        <p class="text-muted">Choose a template to quickly set up your landing page with pre-configured widgets and layouts.</p>
                    </div>
                    
                    <div class="row">
                        <div *ngFor="let template of availableTemplates()" 
                             class="col-md-6 col-lg-4 mb-4">
                            <div class="card h-100 cursor-pointer" 
                                 [class.border-primary]="selectedTemplate()?.id === template.id"
                                 (click)="selectTemplate(template)"
                                 (mouseover)="onCardHover($event, true)"
                                 (mouseout)="onCardHover($event, false)">
                                
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                     style="height: 150px;">
                                    <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
                                </div>
                                
                                <div class="card-body">
                                    <h5 class="card-title">{{ template.name }}</h5>
                                    <p class="card-text text-muted small">{{ template.description }}</p>
                                    
                                    <div class="mb-2">
                                        <div class="d-flex flex-wrap gap-1">
                                            <span *ngFor="let feature of template.features.slice(0, 3)" 
                                                  class="badge bg-light text-dark me-1">
                                                {{ feature }}
                                            </span>
                                            <span *ngIf="template.features.length > 3" 
                                                  class="badge bg-light text-dark">
                                                +{{ template.features.length - 3 }} more
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">{{ template.category }}</small>
                                        <span *ngIf="template.isPremium" class="badge bg-warning text-dark">
                                            Premium
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div *ngIf="availableTemplates().length === 0" class="text-center py-5">
                        <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">No templates available for your subscription tier.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" 
                            class="btn btn-outline-secondary" 
                            (click)="cancelTemplateSelection()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast & Confirmation Dialog -->
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>
</div>
