<div class="bg-gray-100 p-4 sm:p-6 lg:p-8 rounded-lg">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-semibold text-gray-800 mb-6">Tenant Settings</h1>

        <div class="space-y-8">
            <!-- General Settings -->
            <div class="bg-white p-6 rounded-lg shadow" *ngIf="tenantSettings.tenantName">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">General</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="tenantName" class="font-medium text-gray-700 mb-2">Tenant Name</label>
                        <input type="text" id="tenantName" [(ngModel)]="tenantSettings.tenantName" required autofocus class="form-control" />
                        <small class="text-danger mt-1" *ngIf="submitted && !tenantSettings.tenantName">Tenant Name is required.</small>
                    </div>

                    <div class="flex flex-col">
                        <label for="currency" class="font-medium text-gray-700 mb-2">Currency</label>
                        <select id="currency" [(ngModel)]="currency" class="form-select">
                            <option *ngFor="let option of currencyOptions" [value]="option.value">{{ option.label }}</option>
                        </select>
                    </div>

                </div>
            </div>

            <!-- Payment Gateway Configuration -->
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-700 mb-1">
                            <i class="bi bi-credit-card me-2 text-primary"></i>Payment Gateway Configuration
                        </h2>
                        <p class="text-sm text-gray-600 mb-0">Configure Ozow payment gateway credentials</p>
                    </div>
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <label for="ozowApiKey" class="form-label fw-semibold">
                            <i class="bi bi-key me-1"></i>Ozow API Key
                        </label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                            <input 
                                type="password" 
                                id="ozowApiKey" 
                                [(ngModel)]="tenantSettings.ozowApiKey" 
                                class="form-control" 
                                placeholder="Enter API Key"
                            />
                        </div>
                        <small class="form-text text-muted">Your Ozow API authentication key</small>
                    </div>

                    <div class="col-md-6">
                        <label for="ozowSiteCode" class="form-label fw-semibold">
                            <i class="bi bi-building me-1"></i>Ozow Site Code
                        </label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-hash"></i></span>
                            <input 
                                type="text" 
                                id="ozowSiteCode" 
                                [(ngModel)]="tenantSettings.ozowSiteCode" 
                                class="form-control" 
                                placeholder="Enter Site Code"
                            />
                        </div>
                        <small class="form-text text-muted">Your unique Ozow site identifier</small>
                    </div>

                    <div class="col-md-6">
                        <label for="ozowPrivateKey" class="form-label fw-semibold">
                            <i class="bi bi-lock me-1"></i>Ozow Private Key
                        </label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                            <input 
                                type="password" 
                                id="ozowPrivateKey" 
                                [(ngModel)]="tenantSettings.ozowPrivateKey" 
                                class="form-control" 
                                placeholder="Enter Private Key"
                            />
                        </div>
                        <small class="form-text text-muted">Your Ozow private encryption key</small>
                    </div>

                    <div class="col-12">
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            <strong>Important:</strong> These credentials are required for payment processing through Ozow. 
                            Obtain these from your Ozow merchant dashboard at <a href="https://dashboard.ozow.com" target="_blank" class="alert-link">dashboard.ozow.com</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security & Verification Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Security & Verification</h2>
                <p class="text-sm text-gray-600 mb-4">Configure identity verification settings for member registration</p>
                
                <div class="space-y-4">
                    <div class="flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <input 
                            type="checkbox" 
                            id="enableIdVerification" 
                            [(ngModel)]="_settings.enableIdVerification" 
                            class="form-check-input h-5 w-5 text-blue-600"
                        />
                        <div class="flex-1">
                            <label for="enableIdVerification" class="font-medium text-gray-800 cursor-pointer">
                                Enable ID Verification
                            </label>
                            <p class="text-sm text-gray-600 mt-1">
                                Enable automatic identity verification using VerifyID.io during member registration. 
                                This applies to Premium tenants only.
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-4 bg-amber-50 border border-amber-200 rounded-lg" [class.opacity-50]="!_settings.enableIdVerification">
                        <input 
                            type="checkbox" 
                            id="requireIdVerificationForRegistration" 
                            [(ngModel)]="_settings.requireIdVerificationForRegistration"
                            [disabled]="!_settings.enableIdVerification"
                            class="form-check-input h-5 w-5 text-amber-600"
                        />
                        <div class="flex-1">
                            <label for="requireIdVerificationForRegistration" class="font-medium text-gray-800 cursor-pointer">
                                Require ID Verification for Registration
                            </label>
                            <p class="text-sm text-gray-600 mt-1">
                                Require ID verification to pass before allowing member registration to complete. 
                                If disabled, registration will proceed even if verification fails.
                            </p>
                        </div>
                    </div>

                    <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                        <div class="flex items-start gap-2">
                            <i class="bi bi-info-circle-fill text-primary mt-1"></i>
                            <div class="text-sm text-gray-700">
                                <p class="font-medium mb-1">About ID Verification:</p>
                                <ul class="list-disc list-inside space-y-1 text-gray-600">
                                    <li>Uses South African ID numbers for verification</li>
                                    <li>Validates identity details against government databases</li>
                                    <li>Provides proof of life checks for claims processing</li>
                                    <li>Only available for Premium subscription tenants</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Uploads -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Branding</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="logo" class="font-medium text-gray-700 mb-2">Logo</label>
                        <input type="file" name="logoFile" accept="image/*" class="form-control" (change)="onLogoUpload($event)" />
                        <img *ngIf="_settings.logo" [src]="getDownloadUrl(_settings.logo)" alt="Logo" class="mt-4 rounded-md" style="max-width: 200px" />
                    </div>

                    <div class="flex flex-col">
                        <label for="favicon" class="font-medium text-gray-700 mb-2">Favicon</label>
                        <input type="file" name="faviconFile" accept="image/*" class="form-control" (change)="onFaviconUpload($event)" />
                        <img *ngIf="_settings.favicon" [src]="getDownloadUrl(_settings.favicon)" alt="Favicon" class="mt-4 rounded-md" style="max-width: 50px" />
                    </div>

                    <div class="flex flex-col md:col-span-2">
                        <label for="cssFile" class="font-medium text-gray-700 mb-2">Custom CSS File</label>
                        <div class="flex items-center gap-4">
                            <input type="file" name="cssFile" accept=".css" class="form-control" (change)="onCssFileUpload($event)" />
                            <a *ngIf="customCssId" (click)="downloadCss()" class="btn btn-secondary mt-2">Download CSS</a>
                        </div>
                    </div>

                    <div class="flex flex-col md:col-span-2">
                        <label for="contractTemplate" class="font-medium text-gray-700 mb-2">Onboarding Contract Template (PDF)</label>
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle me-2"></i>
                            Upload a PDF template with fillable form fields for member onboarding contracts. The system will automatically populate fields like member name, ID number, policy details, etc.
                        </div>
                        <div class="flex items-center gap-4">
                            <input type="file" name="contractTemplate" accept=".pdf" class="form-control" (change)="onContractTemplateUpload($event)" />
                            <button *ngIf="_settings.contractTemplateFileId" (click)="removeContractTemplate()" class="btn btn-danger">
                                <i class="bi bi-trash me-1"></i> Remove Template
                            </button>
                        </div>
                        <div *ngIf="_settings.contractTemplateFileId" class="alert alert-success mt-2">
                            <i class="bi bi-check-circle me-2"></i>
                            Contract template is active (ID: {{ _settings.contractTemplateFileId }})
                        </div>
                    </div>

                    <div class="flex flex-col md:col-span-2">
                        <label class="font-medium text-gray-700 mb-2">Onboarding Field Configurations</label>
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle me-2"></i>
                            Click the button below to synchronize onboarding form fields. This will add any new fields (like Title, Occupation, Marital Status) to your tenant's configuration.
                        </div>
                        <div>
                            <button (click)="syncFieldConfigurations()" class="btn-primary-theme"><i class="bi bi-arrow-repeat me-1"></i> Sync Field Configurations</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theme Colors -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Theme Colors</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="testcolour" class="font-medium text-gray-700 mb-2">test_colour</label>
                        <input type="color" [(ngModel)]="_settings.testcolour" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="primaryColor" class="font-medium text-gray-700 mb-2">Primary Color</label>
                        <input type="color" [(ngModel)]="_settings.primaryColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="secondaryColor" class="font-medium text-gray-700 mb-2">Secondary Color</label>
                        <input type="color" [(ngModel)]="_settings.secondaryColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="accentColor" class="font-medium text-gray-700 mb-2">Accent Color</label>
                        <input type="color" [(ngModel)]="_settings.accentColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="textColor" class="font-medium text-gray-700 mb-2">Text Color</label>
                        <input type="color" [(ngModel)]="_settings.textColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="backgroundColor" class="font-medium text-gray-700 mb-2">Background Color</label>
                        <input type="color" [(ngModel)]="_settings.backgroundColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="borderColor" class="font-medium text-gray-700 mb-2">Border Color</label>
                        <input type="color" [(ngModel)]="_settings.borderColor" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="buttonPrimaryHoverBackground" class="font-medium text-gray-700 mb-2">Button Primary Hover Background</label>
                        <input type="color" [(ngModel)]="_settings.buttonPrimaryHoverBackground" class="form-control form-control-color" />
                    </div>
                    <div class="flex flex-col">
                        <label for="primaryActiveColor" class="font-medium text-gray-700 mb-2">Primary Active Color</label>
                        <input type="color" [(ngModel)]="_settings.primaryActiveColor" class="form-control form-control-color" />
                    </div>
                </div>
            </div>

            <!-- Button Styles -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Button Styles</h2>
                <p class="text-sm text-gray-600 mb-4">Customize the appearance of buttons throughout your application</p>
                
                <!-- Quick Theme Presets -->
                <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                    <h3 class="text-md font-semibold text-blue-900 mb-3 flex items-center gap-2">
                        <i class="pi pi-palette"></i>
                        Quick Color Presets
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <button 
                            class="px-4 py-2 rounded-lg text-white font-medium text-sm transition-all hover:scale-105"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                            (click)="applyPreset('purple')">
                            Purple Gradient
                        </button>
                        <button 
                            class="px-4 py-2 rounded-lg text-white font-medium text-sm transition-all hover:scale-105"
                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%)"
                            (click)="applyPreset('green')">
                            Success Green
                        </button>
                        <button 
                            class="px-4 py-2 rounded-lg text-white font-medium text-sm transition-all hover:scale-105"
                            style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)"
                            (click)="applyPreset('blue')">
                            Professional Blue
                        </button>
                        <button 
                            class="px-4 py-2 rounded-lg text-white font-medium text-sm transition-all hover:scale-105"
                            style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%)"
                            (click)="applyPreset('orange')">
                            Warm Orange
                        </button>
                        <button 
                            class="px-4 py-2 rounded-lg text-white font-medium text-sm transition-all hover:scale-105"
                            style="background: linear-gradient(135deg, #1f2937 0%, #374151 100%)"
                            (click)="applyPreset('dark')">
                            Modern Dark
                        </button>
                    </div>
                    <p class="text-xs text-blue-700 mt-2">
                        Click a preset to instantly apply colors. You can customize further below.
                    </p>
                </div>
                
                <div class="space-y-6">
                    <!-- Primary Button Styles -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Primary Button</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex flex-col">
                                <label for="buttonPrimaryBackground" class="font-medium text-gray-700 mb-2">Background Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonPrimaryBackground"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Default button background</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonPrimaryBorder" class="font-medium text-gray-700 mb-2">Border Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonPrimaryBorder"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Button border color</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonPrimaryColor" class="font-medium text-gray-700 mb-2">Text Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonPrimaryColor"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Button text color</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonPrimaryHoverBackground" class="font-medium text-gray-700 mb-2">Hover Background</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonPrimaryHoverBackground"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Background on hover</small>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Button Styles -->
                    <div class="border-l-4 border-gray-400 pl-4">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Secondary Button</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex flex-col">
                                <label for="buttonSecondaryBackground" class="font-medium text-gray-700 mb-2">Background Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonSecondaryBackground"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Secondary button background</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonSecondaryBorder" class="font-medium text-gray-700 mb-2">Border Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonSecondaryBorder"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Secondary border color</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonSecondaryColor" class="font-medium text-gray-700 mb-2">Text Color</label>
                                <p-colorPicker [(ngModel)]="_settings.buttonSecondaryColor"></p-colorPicker>
                                <small class="text-gray-500 mt-1">Secondary text color</small>
                            </div>
                        </div>
                    </div>

                    <!-- Button Shape & Size -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Button Shape & Size</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex flex-col">
                                <label for="buttonBorderRadius" class="font-medium text-gray-700 mb-2">Border Radius</label>
                                <input type="text" id="buttonBorderRadius" [(ngModel)]="_settings.buttonBorderRadius" class="form-control" placeholder="e.g., 4px, 8px, 50%" />
                                <small class="text-gray-500 mt-1">Rounded corners (e.g., 4px, 0.5rem)</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonPadding" class="font-medium text-gray-700 mb-2">Padding</label>
                                <input type="text" id="buttonPadding" [(ngModel)]="_settings.buttonPadding" class="form-control" placeholder="e.g., 10px 20px" />
                                <small class="text-gray-500 mt-1">Button spacing (e.g., 0.5rem 1rem)</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonFontSize" class="font-medium text-gray-700 mb-2">Font Size</label>
                                <input type="text" id="buttonFontSize" [(ngModel)]="_settings.buttonFontSize" class="form-control" placeholder="e.g., 14px, 1rem" />
                                <small class="text-gray-500 mt-1">Button text size</small>
                            </div>
                            <div class="flex flex-col">
                                <label for="buttonFontWeight" class="font-medium text-gray-700 mb-2">Font Weight</label>
                                <input type="text" id="buttonFontWeight" [(ngModel)]="_settings.buttonFontWeight" class="form-control" placeholder="e.g., 500, bold" />
                                <small class="text-gray-500 mt-1">Text weight (e.g., 400, 500, bold)</small>
                            </div>
                        </div>
                    </div>

                    <!-- Button Preview -->
                    <div class="border-l-4 border-green-500 pl-4 bg-gray-50 p-4 rounded">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Preview</h3>
                        <div class="flex flex-wrap gap-4">
                            <button 
                                class="preview-button primary"
                                [style.background-color]="_settings.buttonPrimaryBackground"
                                [style.border-color]="_settings.buttonPrimaryBorder"
                                [style.color]="_settings.buttonPrimaryColor"
                                [style.border-radius]="_settings.buttonBorderRadius"
                                [style.padding]="_settings.buttonPadding"
                                [style.font-size]="_settings.buttonFontSize"
                                [style.font-weight]="_settings.buttonFontWeight">
                                Primary Button
                            </button>
                            <button 
                                class="preview-button secondary"
                                [style.background-color]="_settings.buttonSecondaryBackground"
                                [style.border-color]="_settings.buttonSecondaryBorder"
                                [style.color]="_settings.buttonSecondaryColor"
                                [style.border-radius]="_settings.buttonBorderRadius"
                                [style.padding]="_settings.buttonPadding"
                                [style.font-size]="_settings.buttonFontSize"
                                [style.font-weight]="_settings.buttonFontWeight">
                                Secondary Button
                            </button>
                        </div>
                        <div class="flex gap-3 mt-4">
                            <!-- Theme preview/apply buttons removed: now handled globally -->
                        </div>
                        <p class="text-sm text-gray-600 mt-3">
                            <i class="pi pi-info-circle mr-2"></i>
                            Click "Preview Theme" to see changes, then "Apply to All Pages" to make buttons visible globally. Remember to save settings.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Font Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Font Settings</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="fontFamily" class="font-medium text-gray-700 mb-2">Font Family</label>
                        <input type="text" id="fontFamily" [(ngModel)]="_settings.fontFamily" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="fontSize" class="font-medium text-gray-700 mb-2">Font Size</label>
                        <input type="text" id="fontSize" [(ngModel)]="_settings.fontSize" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="fontWeight" class="font-medium text-gray-700 mb-2">Font Weight</label>
                        <input type="text" id="fontWeight" [(ngModel)]="_settings.fontWeight" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="lineHeight" class="font-medium text-gray-700 mb-2">Line Height</label>
                        <input type="text" id="lineHeight" [(ngModel)]="_settings.lineHeight" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- Common Variables -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Common Variables</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="primaryContrastColor" class="font-medium text-gray-700 mb-2">Primary Contrast Color</label>
                        <input type="text" id="primaryContrastColor" [(ngModel)]="_settings.primaryContrastColor" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="textMutedColor" class="font-medium text-gray-700 mb-2">Text Muted Color</label>
                        <input type="text" id="textMutedColor" [(ngModel)]="_settings.textMutedColor" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="contentBorderColor" class="font-medium text-gray-700 mb-2">Content Border Color</label>
                        <input type="text" id="contentBorderColor" [(ngModel)]="_settings.contentBorderColor" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="contentBackground" class="font-medium text-gray-700 mb-2">Content Background</label>
                        <input type="text" id="contentBackground" [(ngModel)]="_settings.contentBackground" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="contentHoverBackground" class="font-medium text-gray-700 mb-2">Content Hover Background</label>
                        <input type="text" id="contentHoverBackground" [(ngModel)]="_settings.contentHoverBackground" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="overlayPopoverBackground" class="font-medium text-gray-700 mb-2">Overlay Popover Background</label>
                        <input type="text" id="overlayPopoverBackground" [(ngModel)]="_settings.overlayPopoverBackground" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="transitionDuration" class="font-medium text-gray-700 mb-2">Transition Duration</label>
                        <input type="text" id="transitionDuration" [(ngModel)]="_settings.transitionDuration" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="maskBackground" class="font-medium text-gray-700 mb-2">Mask Background</label>
                        <input type="text" id="maskBackground" [(ngModel)]="_settings.maskBackground" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="contentBorderRadius" class="font-medium text-gray-700 mb-2">Content Border Radius</label>
                        <input type="text" id="contentBorderRadius" [(ngModel)]="_settings.contentBorderRadius" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="layoutSectionTransitionDuration" class="font-medium text-gray-700 mb-2">Layout Section Transition Duration</label>
                        <input type="text" id="layoutSectionTransitionDuration" [(ngModel)]="_settings.layoutSectionTransitionDuration" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="elementTransitionDuration" class="font-medium text-gray-700 mb-2">Element Transition Duration</label>
                        <input type="text" id="elementTransitionDuration" [(ngModel)]="_settings.elementTransitionDuration" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="focusRingWidth" class="font-medium text-gray-700 mb-2">Focus Ring Width</label>
                        <input type="text" id="focusRingWidth" [(ngModel)]="_settings.focusRingWidth" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="focusRingStyle" class="font-medium text-gray-700 mb-2">Focus Ring Style</label>
                        <input type="text" id="focusRingStyle" [(ngModel)]="_settings.focusRingStyle" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="focusRingColor" class="font-medium text-gray-700 mb-2">Focus Ring Color</label>
                        <input type="text" id="focusRingColor" [(ngModel)]="_settings.focusRingColor" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="focusRingOffset" class="font-medium text-gray-700 mb-2">Focus Ring Offset</label>
                        <input type="text" id="focusRingOffset" [(ngModel)]="_settings.focusRingOffset" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="focusRingShadow" class="font-medium text-gray-700 mb-2">Focus Ring Shadow</label>
                        <input type="text" id="focusRingShadow" [(ngModel)]="_settings.focusRingShadow" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- Dark Theme Variables -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Dark Theme Variables</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="surface950" class="font-medium text-gray-700 mb-2">Surface 950 (Dark)</label>
                        <input type="text" id="surface950" [(ngModel)]="_settings.surface950" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="surface800" class="font-medium text-gray-700 mb-2">Surface 800 (Dark)</label>
                        <input type="text" id="surface800" [(ngModel)]="_settings.surface800" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="surface100" class="font-medium text-gray-700 mb-2">Surface 100 (Dark)</label>
                        <input type="text" id="surface100" [(ngModel)]="_settings.surface100" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- Light Theme Variables -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Light Theme Variables</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="surface900" class="font-medium text-gray-700 mb-2">Surface 900 (Light)</label>
                        <input type="text" id="surface900" [(ngModel)]="_settings.surface900" class="form-control" />
                    </div>
                    <div class="flex flex-col">
                        <label for="surface200" class="font-medium text-gray-700 mb-2">Surface 200 (Light)</label>
                        <input type="text" id="surface200" [(ngModel)]="_settings.surface200" class="form-control" />
                    </div>
                </div>
            </div>

            <!-- SMTP Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">SMTP Settings</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="flex flex-col">
                        <label for="smtpServer" class="font-medium text-gray-700 mb-2">SMTP Server</label>
                        <input type="text" id="smtpServer" [(ngModel)]="smtpSettings.smtpServer" class="form-control" />
                    </div>

                    <div class="flex flex-col">
                        <label for="smtpPort" class="font-medium text-gray-700 mb-2">SMTP Port</label>
                        <input type="number" id="smtpPort" [(ngModel)]="smtpSettings.smtpPort" class="form-control" />
                    </div>

                    <div class="flex flex-col">
                        <label for="smtpUsername" class="font-medium text-gray-700 mb-2">SMTP Username</label>
                        <input type="text" id="smtpUsername" [(ngModel)]="smtpSettings.smtpUsername" class="form-control" />
                    </div>

                    <div class="flex flex-col">
                        <label for="smtpPassword" class="font-medium text-gray-700 mb-2">SMTP Password</label>
                        <input type="password" id="smtpPassword" [(ngModel)]="smtpSettings.smtpPassword" class="form-control" />
                    </div>

                    <div class="flex items-center md:col-span-2">
                        <input type="checkbox" id="enableSsl" [(ngModel)]="smtpSettings.enableSsl" class="form-check-input" />
                        <label for="enableSsl" class="ml-2 font-medium text-gray-700">Enable SSL</label>
                    </div>
                </div>
            </div>

            <!-- Notification Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Notifications</h2>
                <div class="flex items-center">
                    <input type="checkbox" id="notifyUsersOnPolicyUpdate" [(ngModel)]="notificationSettings.notifyUsersOnPolicyUpdate" class="form-check-input" />
                    <label for="notifyUsersOnPolicyUpdate" class="ml-2 font-medium text-gray-700">Notify Users on Policy Update</label>
                </div>
            </div>

            <!-- Premium Calculation Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <h2 class="text-xl font-semibold text-gray-700">Premium Calculation Settings</h2>
                        <p class="text-sm text-gray-600 mt-1">Configure premium tables for policy covers and extended family benefits</p>
                    </div>
                    <button type="button" class="btn btn-outline-primary" (click)="openPremiumSettings()">
                        <i class="pi pi-calculator me-2"></i>
                        Configure Premiums
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600">
                            <i class="pi pi-table"></i>
                        </div>
                        <div class="text-sm text-gray-600 mt-2">Policy Cover Tables</div>
                        <p class="text-xs text-gray-500 mt-1">Configure premiums based on cover amount and dependents</p>
                    </div>
                    <div class="text-center p-4 bg-indigo-50 rounded-lg">
                        <div class="text-2xl font-bold text-indigo-600">
                            <i class="pi pi-users"></i>
                        </div>
                        <div class="text-sm text-gray-600 mt-2">Extended Family Benefits</div>
                        <p class="text-xs text-gray-500 mt-1">Configure premiums based on age ranges</p>
                    </div>
                </div>
            </div>

            <!-- Team Management Section -->
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">Team Management</h2>
                    <button type="button" class="btn btn-outline-secondary" (click)="openTeamManagement()">
                        <i class="pi pi-users me-2"></i>
                        Manage Team
                    </button>
                </div>

                <!-- Team Summary -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600">{{ getTeamMemberCount() }}</div>
                        <div class="text-sm text-gray-600">Total Members</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600">{{ getActiveTeamMemberCount() }}</div>
                        <div class="text-sm text-gray-600">Active Members</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600">{{ getUniqueRoleCount() }}</div>
                        <div class="text-sm text-gray-600">Unique Roles</div>
                    </div>
                </div>

                <!-- Quick Team Overview -->
                <div *ngIf="teamMembers.length > 0" class="space-y-2">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Recent Team Members</h3>
                    <div class="space-y-2 max-h-48 overflow-y-auto">
                        <div *ngFor="let member of getRecentTeamMembers()" class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium" [style.background-color]="getAvatarColor(member.name)">
                                    {{ getInitials(member.name) }}
                                </div>
                                <div>
                                    <div class="font-medium text-gray-900">{{ member.name }}</div>
                                    <div class="text-sm text-gray-500">{{ member.email }}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-gray-700">{{ member.role }}</div>
                                <div class="text-xs text-gray-500">{{ member.department || 'No dept.' }}</div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="teamMembers.length > 5" class="text-center mt-3">
                        <button type="button" class="btn btn-sm btn-link" (click)="openTeamManagement()">
                            View All ({{ teamMembers.length }} members)
                        </button>
                    </div>
                </div>

                <div *ngIf="teamMembers.length === 0" class="text-center py-8">
                    <i class="pi pi-users text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500 mb-4">No team members have been added yet</p>
                    <button type="button" class="btn btn-primary" (click)="openTeamManagement()">
                        <i class="pi pi-plus me-2"></i>
                        Add First Team Member
                    </button>
                </div>
            </div>

            <!-- Other Settings -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Other Settings</h2>
                <div class="flex flex-col">
                    <label for="settings" class="font-medium text-gray-700 mb-2">Settings (JSON)</label>
                    <textarea id="settings" [ngModel]="_settings | json" rows="5" [disabled]="true" class="form-control"></textarea>
                </div>
            </div>

            <div class="flex justify-end pt-6">
                <button type="button" class="btn btn-primary" (click)="saveSettings()">
                    <i class="pi pi-check me-2"></i>
                    Save
                </button>
            </div>
        </div>
    </div>
</div>

<p-toast></p-toast>

<!-- Team Management Dialog -->
<p-dialog header="Team Management" [(visible)]="showTeamManagementDialog" [modal]="true" [style]="{ width: '90vw', maxWidth: '1200px' }" [draggable]="false" [resizable]="false">
    <div class="team-management-content">
        <app-team-editor [config]="teamEditorConfig"></app-team-editor>
    </div>

    <ng-template pTemplate="footer">
        <div class="flex justify-end gap-2">
            <button type="button" class="btn btn-secondary" (click)="showTeamManagementDialog = false">
                <i class="pi pi-times me-2"></i>
                Close
            </button>
            <button type="button" class="btn btn-success" (click)="saveTeamChanges()">
                <i class="pi pi-check me-2"></i>
                Save Changes
            </button>
        </div>
    </ng-template>
</p-dialog>

<!-- Premium Calculation Settings Modal (Bootstrap) -->
<div class="modal fade" [class.show]="showPremiumSettingsDialog" [style.display]="showPremiumSettingsDialog ? 'block' : 'none'" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document" style="max-width: 1400px;">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-calculator me-2"></i>Premium Calculation Settings
                </h5>
                <button type="button" class="btn-close btn-close-white" (click)="showPremiumSettingsDialog = false"></button>
            </div>
            
            <div class="modal-body">
                <div *ngIf="loadingPremiumSettings" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="text-muted mt-3">Loading premium settings...</p>
                </div>

                <div *ngIf="!loadingPremiumSettings && premiumSettings" class="premium-settings-content">
                    <!-- Policy Cover Premium Table -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <h5 class="card-title mb-1">Policy Cover Premium Table</h5>
                                    <p class="text-muted small mb-0">Configure premiums with flexible dependent count tiers (e.g., 1-5, 6-9, 10-15)</p>
                                </div>
                                <button type="button" class="btn btn-sm btn-primary" (click)="addCoverRow()">
                                    <i class="bi bi-plus-lg me-2"></i>Add Cover Amount
                                </button>
                            </div>

                            <!-- Loop through each cover amount row -->
                            <div *ngFor="let row of premiumSettings.policyCoverTable.rows; let rowIndex = index" class="border rounded p-3 mb-3 bg-light">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <label class="form-label mb-0 fw-semibold">Cover Amount (R):</label>
                                        <input type="number" class="form-control form-control-sm" style="width: 150px;" [(ngModel)]="row.coverAmount" placeholder="e.g., 10000" />
                                    </div>
                                    <button type="button" class="btn btn-sm btn-danger" (click)="removeCoverRow(rowIndex)">
                                        <i class="bi bi-trash me-1"></i>Remove Cover
                                    </button>
                                </div>

                                <!-- Dependent Count Tiers Section -->
                                <div class="bg-white rounded p-3">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h6 class="mb-0">Dependent Count Tiers</h6>
                                        <button type="button" class="btn btn-sm btn-success" (click)="addDependentTier(rowIndex)">
                                            <i class="bi bi-plus-lg me-1"></i>Add Tier
                                        </button>
                                    </div>

                                    <!-- Show tiers if they exist -->
                                    <div *ngIf="row.dependentCountTiers && row.dependentCountTiers.length > 0" class="vstack gap-3">
                                        <div *ngFor="let tier of row.dependentCountTiers; let tierIndex = index" class="border rounded p-3 bg-light">
                                            <div class="row g-2 align-items-center mb-3">
                                                <div class="col-md-3">
                                                    <label class="form-label small text-muted">Min Dependents</label>
                                                    <input type="number" class="form-control form-control-sm" [(ngModel)]="tier.minDependents" placeholder="e.g., 1" />
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label small text-muted">Max Dependents</label>
                                                    <input type="number" class="form-control form-control-sm" [(ngModel)]="tier.maxDependents" placeholder="e.g., 5" />
                                                </div>
                                                <div class="col-md-5">
                                                    <label class="form-label small text-muted">Label</label>
                                                    <input type="text" class="form-control form-control-sm" [(ngModel)]="tier.label" placeholder="e.g., 1-5 dependents" />
                                                </div>
                                                <div class="col-md-1 text-end">
                                                    <button type="button" class="btn btn-sm btn-danger" (click)="removeDependentTier(rowIndex, tierIndex)">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Age Brackets for this tier -->
                                            <div class="mt-3 ps-3 border-start border-primary border-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="small fw-semibold">Age Brackets</span>
                                                    <button type="button" class="btn btn-xs btn-sm btn-primary" (click)="addAgeBracket(rowIndex, tierIndex)">
                                                        <i class="bi bi-plus-lg me-1"></i>Add Age Bracket
                                                    </button>
                                                </div>

                                                <div *ngIf="getAgeBracketsArray(tier).length > 0" class="vstack gap-2">
                                                    <div *ngFor="let bracket of getAgeBracketsArray(tier); trackBy: trackByBracketKey; let bracketIndex = index" class="row g-2 align-items-center bg-white p-2 rounded">
                                                        <div class="col-md-3">
                                                            <label class="form-label small text-muted mb-1">Max Age</label>
                                                            <input type="number" class="form-control form-control-sm" [(ngModel)]="bracket.key" placeholder="e.g., 64" readonly />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label small text-muted mb-1">Label</label>
                                                            <input type="text" class="form-control form-control-sm" [(ngModel)]="bracket.value.label" placeholder="e.g., Under 65" />
                                                        </div>
                                                        <div class="col-md-4">
                                                            <label class="form-label small text-muted mb-1">Premium (R)</label>
                                                            <input type="number" class="form-control form-control-sm" [(ngModel)]="bracket.value.premium" placeholder="e.g., 220" />
                                                        </div>
                                                        <div class="col-md-1 text-end">
                                                            <button type="button" class="btn btn-xs btn-sm btn-danger" (click)="removeAgeBracket(tier, bracket.key)">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div *ngIf="getAgeBracketsArray(tier).length === 0" class="small text-muted fst-italic py-2">
                                                    No age brackets defined. Click "Add Age Bracket" to create one.
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Empty state for tiers -->
                                    <div *ngIf="!row.dependentCountTiers || row.dependentCountTiers.length === 0" class="text-center py-4 text-muted small">
                                        No dependent count tiers defined. Click "Add Tier" to create one (e.g., 1-5, 6-9).
                                    </div>
                                </div>
                            </div>

                            <!-- Empty state for cover amounts -->
                            <div *ngIf="!premiumSettings.policyCoverTable.rows || premiumSettings.policyCoverTable.rows.length === 0" class="text-center py-5 text-muted">
                                No cover amounts defined. Click "Add Cover Amount" to get started.
                            </div>
                        </div>
                    </div>

                    <!-- Extended Family Benefit Table -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <h5 class="card-title mb-1">Extended Family Benefit Table</h5>
                                    <p class="text-muted small mb-0">Configure premiums for extended family members based on age ranges and cover amounts</p>
                                </div>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-sm btn-outline-primary" (click)="addExtendedFamilyColumn()" title="Add Cover Column">
                                        <i class="bi bi-plus-lg me-2"></i>Add Column
                                    </button>
                                    <button type="button" class="btn btn-sm btn-primary" (click)="addExtendedFamilyRow()">
                                        <i class="bi bi-plus-lg me-2"></i>Add Row
                                    </button>
                                </div>
                            </div>

                            <!-- Column Management -->
                            <div class="mb-3 p-3 bg-light rounded" *ngIf="extendedFamilyColumns.length > 0">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0 fw-semibold">Cover Amount Columns</h6>
                                    <small class="text-muted">Click the X to remove a column</small>
                                </div>
                                <div class="d-flex flex-wrap gap-2">
                                    <span *ngFor="let column of extendedFamilyColumns; let i = index" 
                                          class="badge bg-primary text-white d-flex align-items-center gap-2">
                                        {{column.label}}
                                        <button type="button" class="btn btn-sm btn-link text-white p-0 m-0" 
                                                (click)="removeExtendedFamilyColumn(i)" 
                                                title="Remove this column">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th class="small">Min Age</th>
                                            <th class="small">Max Age</th>
                                            <th class="small">Age Range</th>
                                            <th class="small" *ngFor="let column of extendedFamilyColumns; let colIndex = index">
                                                {{column.label}}
                                                <button type="button" class="btn btn-sm btn-link text-danger p-0 ms-1" 
                                                        (click)="removeExtendedFamilyColumn(colIndex)" 
                                                        title="Remove this column">
                                                    <i class="bi bi-x"></i>
                                                </button>
                                            </th>
                                            <th class="small">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let row of premiumSettings.extendedFamilyTable.rows; let i = index">
                                            <td><input type="number" class="form-control form-control-sm" [(ngModel)]="row.minAge" placeholder="e.g., 0" /></td>
                                            <td><input type="number" class="form-control form-control-sm" [(ngModel)]="row.maxAge" placeholder="e.g., 20" /></td>
                                            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="row.ageRange" placeholder="e.g., 0-20" /></td>
                                            <td *ngFor="let column of extendedFamilyColumns">
                                                <input type="number" 
                                                       class="form-control form-control-sm" 
                                                       [value]="getRowPropertyValue(row, column.key)"
                                                       (input)="setRowPropertyValue(row, column.key, $any($event.target).value)"
                                                       placeholder="e.g., 50" />
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-sm btn-danger" (click)="removeExtendedFamilyRow(i)">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Empty state -->
                            <div *ngIf="!premiumSettings.extendedFamilyTable.rows || premiumSettings.extendedFamilyTable.rows.length === 0" 
                                 class="text-center py-5 text-muted">
                                <i class="bi bi-table fs-1 mb-3 d-block"></i>
                                <p class="mb-3">No age ranges defined. Click "Add Row" to get started.</p>
                                <button type="button" class="btn btn-outline-primary" (click)="addExtendedFamilyRow()">
                                    <i class="bi bi-plus-lg me-2"></i>Add First Row
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <div class="d-flex align-items-start gap-3">
                            <i class="bi bi-info-circle-fill fs-5"></i>
                            <div class="small">
                                <p class="fw-semibold mb-2">Premium Calculation Guidelines:</p>
                                <ul class="mb-0">
                                    <li><strong>Policy Cover Table:</strong> Defines base premiums based on cover amount and dependent count/age brackets</li>
                                    <li><strong>Extended Family Table:</strong> Additional premiums for extended family members based on their age and selected cover</li>
                                    <li>Premium amounts should be in the tenant's configured currency ({{currency}})</li>
                                    <li>Changes take effect immediately for new premium calculations</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="showPremiumSettingsDialog = false">
                    <i class="bi bi-x-lg me-2"></i>Close
                </button>
                <button type="button" class="btn btn-success" (click)="savePremiumSettings()">
                    <i class="bi bi-check-lg me-2"></i>Save Premium Settings
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="showPremiumSettingsDialog" *ngIf="showPremiumSettingsDialog"></div>
