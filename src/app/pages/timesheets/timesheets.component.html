<div class="modern-card">
    <div class="card-header">
        <div class="section-header">
            <i class="pi pi-clock text-orange-600"></i>
            <h3>Timesheet Management</h3>
        </div>
    </div>

    <p-toast></p-toast>
    <p-confirmDialog [style]="{ width: '450px' }" styleClass="modern-confirm-dialog"></p-confirmDialog>

    <div class="card-body">
        <div class="mb-6">
            <button type="button" class="btn btn-primary" (click)="openNew()">
                <i class="pi pi-plus me-2"></i>
                New Entry
            </button>
        </div>

        <p-table
            [value]="timesheetEntries()"
            [loading]="loading()"
            responsiveLayout="scroll"
            [paginator]="true"
            [rows]="10"
            styleClass="modern-table"
            [rowHover]="true"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [rowsPerPageOptions]="[10, 20, 30]"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th style="min-width: 8rem">ID</th>
                    <th style="min-width: 10rem">Date</th>
                    <th style="min-width: 8rem">Hours</th>
                    <th style="min-width: 20rem">Description</th>
                    <th style="min-width: 12rem">Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-entry>
                <tr>
                    <td>{{ entry.id }}</td>
                    <td>
                        <span class="font-semibold text-blue-600">
                            {{ entry.date | date: 'mediumDate' }}
                        </span>
                    </td>
                    <td>
                        <span class="hours-badge">{{ entry.hoursWorked }} hrs</span>
                    </td>
                    <td>
                        <span class="text-gray-600" [title]="entry.description">
                            {{ entry.description || 'No description' }}
                        </span>
                    </td>
                    <td>
                        <div class="flex gap-2">
                            <button type="button" class="btn btn-sm btn-outline-primary rounded-circle" (click)="editTimesheetEntry(entry)" title="Edit Entry">
                                <i class="pi pi-pencil"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger rounded-circle" (click)="deleteTimesheetEntry(entry)" title="Delete Entry">
                                <i class="pi pi-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <!-- Timesheet Entry Dialog -->
        <p-dialog [(visible)]="timesheetDialogVisible" [style]="{ width: '500px' }" header="Timesheet Entry" [modal]="true" styleClass="p-fluid">
            <ng-template pTemplate="content">
                <div class="field">
                    <label for="date">Date</label>
                    <p-calendar id="date" [(ngModel)]="timesheetEntry.date" placeholder="Select Date" [class]="{ 'ng-invalid ng-dirty': submitted() && !timesheetEntry.date }"></p-calendar>
                    <small class="p-error" *ngIf="submitted() && !timesheetEntry.date">Date is required.</small>
                </div>

                <div class="field">
                    <label for="hoursWorked">Hours Worked</label>
                    <input type="text" pInputText id="hoursWorked" [(ngModel)]="timesheetEntry.hoursWorked" placeholder="e.g., 8.5" [class]="{ 'ng-invalid ng-dirty': submitted() && !timesheetEntry.hoursWorked }" />
                    <small class="p-error" *ngIf="submitted() && !timesheetEntry.hoursWorked">Hours worked is required.</small>
                </div>

                <div class="field">
                    <label for="description">Description</label>
                    <textarea id="description" pInputTextarea [(ngModel)]="timesheetEntry.description" rows="3" cols="30" placeholder="Enter work description"></textarea>
                </div>
            </ng-template>

            <ng-template pTemplate="footer">
                <button type="button" class="btn btn-secondary" (click)="hideDialog()">
                    <i class="pi pi-times me-2"></i>
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" (click)="saveTimesheetEntry()">
                    <i class="pi pi-check me-2"></i>
                    Save
                </button>
            </ng-template>
        </p-dialog>
    </div>
</div>
