<div class="terms-step">
    <p-toast></p-toast>
    
    @if (loading()) {
        <div class="loading-message">
            <i class="pi pi-spin pi-spinner"></i>
            Loading terms and conditions...
        </div>
    }

    @if (!loading() && hasAccepted()) {
        <div class="success-message">
            <div class="success-icon">
                <i class="pi pi-check-circle"></i>
            </div>
            <h3>Terms Accepted</h3>
            <p>{{ viewMode ? 'This member has' : 'You have' }} accepted the current terms and conditions.</p>
            @if (activeTerms()) {
                <div class="terms-info mt-3">
                    <p><strong>{{ activeTerms()?.title || 'Terms and Conditions' }}</strong></p>
                    <p class="text-muted">Version {{ activeTerms()?.version || '1.0' }} - Effective Date: {{ formatDate(activeTerms()?.effectiveDate) }}</p>
                </div>
            }
        </div>
    }

    @if (!loading() && !hasAccepted() && activeTerms()) {
        <p-card class="terms-card">
            <ng-template pTemplate="header">
                <div class="card-header">
                    <h2>{{ activeTerms()?.title || 'Terms and Conditions' }}</h2>
                    <div class="terms-metadata">
                        <span class="version">Version {{ activeTerms()?.version || '1.0' }}</span>
                        <span class="effective-date">
                            Effective Date: {{ formatDate(activeTerms()?.effectiveDate) }}
                        </span>
                    </div>
                </div>
            </ng-template>

            <div class="terms-content" [innerHTML]="activeTerms()?.content || 'No terms available'">
            </div>

            @if (!viewMode) {
                <ng-template pTemplate="footer">
                    <div class="acceptance-section">
                        <div class="checkbox-wrapper">
                            <p-checkbox 
                                [(ngModel)]="termsAccepted" 
                                [binary]="true" 
                                inputId="acceptTerms">
                            </p-checkbox>
                            <label for="acceptTerms" class="acceptance-label">
                                I have read and agree to the terms and conditions
                            </label>
                        </div>
                        
                        <button 
                            type="button"
                            class="btn-primary-theme btn-theme-lg"
                            (click)="acceptTerms()"
                            [disabled]="!termsAccepted || accepting()">
                            <i class="pi pi-check me-2"></i>
                            @if (accepting()) {
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            }
                            Accept and Continue
                        </button>
                    </div>
                </ng-template>
            }
            
            @if (viewMode) {
                <ng-template pTemplate="footer">
                    <div class="view-mode-notice">
                        <i class="pi pi-info-circle me-2"></i>
                        <span>Terms have not been accepted by this member yet.</span>
                    </div>
                </ng-template>
            }
        </p-card>
    }

    @if (!loading() && !hasAccepted() && !activeTerms()) {
        <div class="empty-state">
            <i class="pi pi-info-circle" style="font-size: 3rem; color: var(--text-color-secondary)"></i>
            <h4>No Terms Available</h4>
            <p>There are currently no active terms and conditions to accept.</p>
        </div>
    }
</div>
