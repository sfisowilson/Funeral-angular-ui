<div class="required-documents">
    <div class="action-bar">
        <button 
            pButton 
            label="Add Required Document" 
            icon="pi pi-plus" 
            class="p-button-primary"
            (click)="openNewDialog()">
        </button>
    </div>

    <p-table 
        [value]="documents()" 
        [loading]="loading()"
        styleClass="p-datatable-gridlines"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20]"
        responsiveLayout="scroll">
        
        <ng-template pTemplate="header">
            <tr>
                <th>Document Name</th>
                <th>Type</th>
                <th>Entity</th>
                <th>Required</th>
                <th>File Types</th>
                <th>Max Size</th>
                <th style="width: 150px">Actions</th>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-doc>
            <tr>
                <td>{{ doc.documentName }}</td>
                <td>{{ getDocumentTypeName(doc.documentType) }}</td>
                <td>{{ getEntityTypeName(doc.entityType) }}</td>
                <td>
                    <span [class]="doc.isRequired ? 'status-badge required' : 'status-badge optional'">
                        {{ doc.isRequired ? 'Required' : 'Optional' }}
                    </span>
                </td>
                <td>{{ doc.allowedFileTypes || 'Any' }}</td>
                <td>{{ formatFileSize(doc.maxFileSizeBytes) }}</td>
                <td>
                    <button 
                        pButton 
                        icon="pi pi-pencil" 
                        class="p-button-text p-button-info"
                        pTooltip="Edit"
                        (click)="editDocument(doc)">
                    </button>
                    <button 
                        pButton 
                        icon="pi pi-trash" 
                        class="p-button-text p-button-danger"
                        pTooltip="Delete"
                        (click)="deleteDocument(doc)">
                    </button>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="7" class="text-center">No required documents configured</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog 
    [(visible)]="showDialog" 
    [header]="isEditMode() ? 'Edit Required Document' : 'Add Required Document'"
    [modal]="true" 
    [style]="{width: '600px'}"
    [draggable]="false"
    [resizable]="false">
    
    <div class="dialog-content">
        <div class="form-grid">
            <div class="form-field full-width">
                <label for="documentName">Document Name *</label>
                <input 
                    id="documentName" 
                    type="text" 
                    pInputText 
                    [(ngModel)]="currentDocument.documentName"
                    placeholder="Enter document name">
            </div>

            <div class="form-field">
                <label for="documentType">Document Type *</label>
                <p-dropdown 
                    id="documentType"
                    [(ngModel)]="currentDocument.documentType"
                    [options]="documentTypeOptions"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Select type">
                </p-dropdown>
            </div>

            <div class="form-field">
                <label for="entityType">Entity Type *</label>
                <p-dropdown 
                    id="entityType"
                    [(ngModel)]="currentDocument.entityType"
                    [options]="entityTypeOptions"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Select entity">
                </p-dropdown>
            </div>

            <div class="form-field full-width">
                <label for="description">Description</label>
                <input 
                    id="description" 
                    type="text" 
                    pInputText 
                    [(ngModel)]="currentDocument.description"
                    placeholder="Optional description">
            </div>

            <div class="form-field">
                <label for="allowedFileTypes">Allowed File Types</label>
                <input 
                    id="allowedFileTypes" 
                    type="text" 
                    pInputText 
                    [(ngModel)]="currentDocument.allowedFileTypes"
                    placeholder="e.g., pdf,jpg,png">
                <small class="help-text">Comma-separated file extensions</small>
            </div>

            <div class="form-field">
                <label for="maxFileSize">Max File Size (MB)</label>
                <p-inputNumber
                    id="maxFileSize"
                    [(ngModel)]="currentDocument.maxFileSizeBytes"
                    mode="decimal"
                    [min]="0"
                    [step]="1048576"
                    suffix=" bytes"
                    placeholder="5242880">
                </p-inputNumber>
                <small class="help-text">5MB = 5242880 bytes</small>
            </div>

            <div class="form-field full-width">
                <div class="switch-field">
                    <label for="isRequired">Required Document</label>
                    <p-inputSwitch 
                        [(ngModel)]="currentDocument.isRequired"
                        inputId="isRequired">
                    </p-inputSwitch>
                </div>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <button 
            pButton 
            label="Cancel" 
            icon="pi pi-times" 
            class="p-button-text"
            (click)="cancel()">
        </button>
        <button 
            pButton 
            label="Save" 
            icon="pi pi-check" 
            class="p-button-primary"
            (click)="saveDocument()">
        </button>
    </ng-template>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
