<div class="card">
  <div class="card-header">
    <h2 class="text-2xl font-bold mb-0">Blog Management</h2>
  </div>

  <div class="card-body">
    <div class="mb-4">
      <button type="button" class="btn btn-success" (click)="openNew()">
        <i class="bi bi-plus-circle"></i> New Blog Post
      </button>
    </div>

    <div class="table-responsive">
      <table class="table table-hover table-striped">
        <thead class="table-light">
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Category</th>
            <th>Status</th>
            <th>Publish Date</th>
            <th>Views</th>
            <th style="width: 10rem">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let post of posts">
            <td>
              <div class="fw-medium">{{ post.title }}</div>
              <div class="text-muted small">{{ post.excerpt }}</div>
            </td>
            <td>{{ post.author }}</td>
            <td>
              <span class="badge bg-blue">
                {{ post.category }}
              </span>
            </td>
            <td>
              <span 
                class="badge"
                [ngClass]="{
                  'bg-success': post.status === 'Published',
                  'bg-warning': post.status === 'Draft',
                  'bg-secondary': post.status === 'Archived'
                }"
              >
                {{ post.status }}
              </span>
            </td>
            <td>{{ post.publishDate?.toJSDate?.() | date: 'short' }}</td>
            <td>{{ post.viewCount }}</td>
            <td>
              <button type="button" class="btn btn-sm btn-info" (click)="editPost(post)" title="Edit">
                <i class="bi bi-pencil"></i>
              </button>
              <button type="button" class="btn btn-sm btn-danger" (click)="deletePost(post)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div *ngIf="posts.length === 0" class="alert alert-info text-center">
        No blog posts found
      </div>
    </div>
  </div>
</div>

<!-- Modal for Create/Edit -->
<div class="modal fade" [class.show]="displayDialog" [style.display]="displayDialog ? 'block' : 'none'" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEditMode ? 'Edit Blog Post' : 'New Blog Post' }}</h5>
        <button type="button" class="btn-close" (click)="hideDialog()"></button>
      </div>
      
      <div class="modal-body">
        <form [formGroup]="blogForm" (ngSubmit)="savePost()">
          <div class="row">
            <!-- Title -->
            <div class="col-12 mb-3">
              <label for="title" class="form-label fw-bold">Title <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="title" formControlName="title" placeholder="Enter blog post title" />
              <small class="text-danger" *ngIf="blogForm.get('title')?.invalid && blogForm.get('title')?.touched">
                Title is required (max 200 characters)
              </small>
            </div>

            <!-- Author -->
            <div class="col-12 col-md-6 mb-3">
              <label for="author" class="form-label fw-bold">Author <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="author" formControlName="author" placeholder="Author name" />
              <small class="text-danger" *ngIf="blogForm.get('author')?.invalid && blogForm.get('author')?.touched">
                Author is required
              </small>
            </div>

            <!-- Publish Date -->
            <div class="col-12 col-md-6 mb-3">
              <label for="publishDate" class="form-label fw-bold">Publish Date <span class="text-danger">*</span></label>
              <input type="datetime-local" class="form-control" id="publishDate" formControlName="publishDate" />
            </div>

            <!-- Category -->
            <div class="col-12 col-md-6 mb-3">
              <label for="category" class="form-label fw-bold">Category <span class="text-danger">*</span></label>
              <select class="form-select" id="category" formControlName="category">
                <option value="">Select category</option>
                <option *ngFor="let option of categoryOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
              <small class="text-danger" *ngIf="blogForm.get('category')?.invalid && blogForm.get('category')?.touched">
                Category is required
              </small>
            </div>

            <!-- Status -->
            <div class="col-12 col-md-6 mb-3">
              <label for="status" class="form-label fw-bold">Status <span class="text-danger">*</span></label>
              <select class="form-select" id="status" formControlName="status">
                <option value="">Select status</option>
                <option *ngFor="let option of statusOptions" [value]="option.value">
                  {{ option.label }}
                </option>
              </select>
            </div>

            <!-- Tags -->
            <div class="col-12 mb-3">
              <label for="tags" class="form-label fw-bold">Tags</label>
              <input type="text" class="form-control" id="tags" formControlName="tags" placeholder="Comma-separated tags (e.g., community, outreach, impact)" />
              <small class="text-muted">Separate multiple tags with commas</small>
            </div>

            <!-- Excerpt -->
            <div class="col-12 mb-3">
              <label for="excerpt" class="form-label fw-bold">Excerpt</label>
              <textarea class="form-control" id="excerpt" formControlName="excerpt" rows="2" placeholder="Brief summary (max 500 characters)"></textarea>
              <small class="text-muted">This will be displayed in post previews</small>
            </div>

            <!-- Content -->
            <div class="col-12 mb-3">
              <label for="content" class="form-label fw-bold">Content <span class="text-danger">*</span></label>
              <textarea class="form-control" id="content" formControlName="content" rows="6" placeholder="Full blog post content"></textarea>
              <small class="text-muted">TODO: Integrate rich text editor (Quill, TinyMCE, etc.)</small>
              <small class="text-danger d-block" *ngIf="blogForm.get('content')?.invalid && blogForm.get('content')?.touched">
                Content is required
              </small>
            </div>

            <!-- Featured Image -->
            <div class="col-12 mb-3">
              <label for="featuredImage" class="form-label fw-bold">Featured Image URL</label>
              <input type="text" class="form-control" id="featuredImage" formControlName="featuredImage" placeholder="https://example.com/image.jpg" />
              <small class="text-muted">TODO: Integrate file upload component</small>
            </div>

            <!-- SEO Section -->
            <div class="col-12 mb-3 border-top pt-3 mt-3">
              <h5 class="fw-bold mb-3">SEO Optimization</h5>
              
              <div class="mb-3">
                <label for="seoTitle" class="form-label">SEO Title</label>
                <input type="text" class="form-control" id="seoTitle" formControlName="seoTitle" placeholder="Optimized title for search engines (max 70 characters)" />
              </div>

              <div class="mb-3">
                <label for="seoDescription" class="form-label">SEO Description</label>
                <textarea class="form-control" id="seoDescription" formControlName="seoDescription" rows="3" placeholder="Meta description for search engines (max 160 characters)"></textarea>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2 border-top pt-3 mt-3">
            <button type="button" class="btn btn-secondary" (click)="hideDialog()">Cancel</button>
            <button type="submit" class="btn btn-success" [disabled]="blogForm.invalid || loading">
              {{ loading ? 'Saving...' : 'Save' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade" [class.show]="displayDialog" *ngIf="displayDialog"></div>
