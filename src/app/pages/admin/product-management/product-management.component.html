<div class="product-management-container">
  <div class="header">
    <h1>Product Management</h1>
    <button class="btn btn-primary" (click)="openModal()">
      <i class="bi bi-plus-circle"></i> Add Product
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="stats">
    <div class="stat-card">
      <div class="stat-value">{{ stats.totalProducts }}</div>
      <div class="stat-label">Total Products</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.activeProducts }}</div>
      <div class="stat-label">Active Products</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.lowStockProducts }}</div>
      <div class="stat-label">Low Stock</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${{ stats.totalInventoryValue | number:'1.2-2' }}</div>
      <div class="stat-label">Inventory Value</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <input type="text" class="form-control" placeholder="Search products..." [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()">
    <select class="form-select" [(ngModel)]="selectedCategory" (ngModelChange)="applyFilters()">
      <option value="">All Categories</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
    </select>
    <select class="form-select" [(ngModel)]="selectedStatus" (ngModelChange)="applyFilters()">
      <option value="">All Status</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
  </div>

  <!-- Products Table -->
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Image</th>
          <th>Product</th>
          <th>SKU</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Category</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts">
          <td><img [src]="product.images?.[0]?.imageUrl || '/assets/placeholder.png'" alt="" class="product-thumb"></td>
          <td>
            <strong>{{ product.name }}</strong>
            <span *ngIf="product.isFeatured" class="badge badge-warning ms-2">Featured</span>
          </td>
          <td>{{ product.sku }}</td>
          <td>${{ product.price | number:'1.2-2' }}</td>
          <td><span class="badge" [ngClass]="getStockClass(product)">{{ getStockStatus(product) }} ({{ product.stockQuantity }})</span></td>
          <td>{{ product.category }}</td>
          <td><span class="badge" [ngClass]="product.isActive ? 'badge-success' : 'badge-secondary'">{{ product.isActive ? 'Active' : 'Inactive' }}</span></td>
          <td>
            <button class="btn btn-sm btn-outline-primary" (click)="openModal(product)"><i class="bi bi-pencil"></i></button>
            <button class="btn btn-sm btn-outline-warning" (click)="toggleFeatured(product)"><i class="bi bi-star"></i></button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteProduct(product.id)"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal" [class.show]="isModalOpen" *ngIf="isModalOpen">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5>{{ isEditMode ? 'Edit Product' : 'Add Product' }}</h5>
          <button class="btn-close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Product Name *</label>
            <input type="text" class="form-control" [(ngModel)]="productForm.name">
          </div>
          <div class="mb-3">
            <label class="form-label">SKU *</label>
            <input type="text" class="form-control" [(ngModel)]="productForm.sku">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Price *</label>
              <input type="number" class="form-control" [(ngModel)]="productForm.price">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Compare at Price</label>
              <input type="number" class="form-control" [(ngModel)]="productForm.compareAtPrice">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Category *</label>
            <select class="form-select" [(ngModel)]="productForm.category">
              <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" rows="4" [(ngModel)]="productForm.description"></textarea>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Quantity</label>
              <input type="number" class="form-control" [(ngModel)]="productForm.stockQuantity">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Low Stock Threshold</label>
              <input type="number" class="form-control" [(ngModel)]="productForm.lowStockThreshold">
            </div>
          </div>
          <div class="mb-3">
            <label class="form-check-label">
              <input type="checkbox" class="form-check-input" [(ngModel)]="productForm.isActive"> Active
            </label>
            <label class="form-check-label ms-3">
              <input type="checkbox" class="form-check-input" [(ngModel)]="productForm.isFeatured"> Featured
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveProduct()">Save Product</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop" *ngIf="isModalOpen" (click)="closeModal()"></div>
</div>
