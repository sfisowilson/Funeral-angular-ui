<div class="careers-container p-4">
    <!-- Header Section with Stats -->
    <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <h2 class="mb-1">Career Opportunities Management</h2>
                <p class="text-muted">Manage job postings and career opportunities for your organization</p>
            </div>
            <button class="btn-primary-theme" (click)="showAddDialog()">
                <i class="bi bi-plus-circle me-2"></i>
                Add New Position
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="row g-3 mb-4" *ngIf="stats">
            <div class="col-md-4">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <h3 class="mb-1">{{ stats.totalOpenings }}</h3>
                        <p class="mb-0">Total Open Positions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <h3 class="mb-1">{{ Object.keys(stats.departmentBreakdown).length }}</h3>
                        <p class="mb-0">Active Departments</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h3 class="mb-1">{{ Object.keys(stats.employmentTypeBreakdown).length }}</h3>
                        <p class="mb-0">Employment Types</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Search</label>
                    <input 
                        type="text" 
                        class="form-control" 
                        placeholder="Search by title, department, location..." 
                        [(ngModel)]="searchTerm" 
                        (ngModelChange)="onSearchChange()" />
                </div>
                <div class="col-md-3">
                    <label class="form-label">Department</label>
                    <select class="form-select" [(ngModel)]="filterDepartment" (ngModelChange)="onFilterChange()">
                        <option value="">All Departments</option>
                        <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Employment Type</label>
                    <select class="form-select" [(ngModel)]="filterEmploymentType" (ngModelChange)="onFilterChange()">
                        <option value="">All Types</option>
                        <option *ngFor="let type of employmentTypes" [value]="type.value">{{ type.label }}</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Status</label>
                    <select class="form-select" [(ngModel)]="filterStatus" (ngModelChange)="onFilterChange()">
                        <option value="all">All</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn-secondary-theme w-100" (click)="clearFilters()" title="Clear Filters">
                        <i class="bi bi-x-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Careers Table -->
    <div class="card">
        <div class="card-body">
            <div *ngIf="loading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading careers...</p>
            </div>

            <div *ngIf="!loading && filteredCareers.length === 0" class="text-center py-5">
                <i class="bi bi-briefcase" style="font-size: 3rem; color: #ccc;"></i>
                <p class="text-muted mt-2">No careers found. Create your first job posting!</p>
            </div>

            <div *ngIf="!loading && filteredCareers.length > 0" class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Job Title</th>
                            <th>Department</th>
                            <th>Location</th>
                            <th>Type</th>
                            <th>Deadline</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let career of filteredCareers">
                            <td>
                                <strong>{{ career.jobTitle }}</strong>
                                <div class="small text-muted">{{ career.salaryRange }}</div>
                            </td>
                            <td>{{ career.department }}</td>
                            <td>{{ career.location }}</td>
                            <td>
                                <span [class]="getEmploymentTypeBadgeClass(career.employmentType)">
                                    {{ career.employmentType }}
                                </span>
                            </td>
                            <td>{{ formatDate(career.applicationDeadline) }}</td>
                            <td>
                                <span [class]="getStatusBadgeClass(career.isActive)">
                                    {{ career.isActive ? 'Active' : 'Inactive' }}
                                </span>
                            </td>
                            <td>
                                <div class="btn-theme-group">
                                    <button class="btn-outline-primary-theme btn-theme-sm" (click)="editCareer(career)" title="Edit">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn-outline-secondary-theme btn-theme-sm" (click)="toggleCareerStatus(career)" 
                                        [title]="career.isActive ? 'Deactivate' : 'Activate'">
                                        <i [class]="career.isActive ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                                    </button>
                                    <button class="btn-outline-danger-theme btn-theme-sm" (click)="deleteCareer(career)" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Career Modal -->
<div class="modal fade" [class.show]="displayDialog" [style.display]="displayDialog ? 'block' : 'none'" 
    tabindex="-1" role="dialog" [attr.aria-hidden]="!displayDialog">
    <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    {{ isEditMode ? 'Edit Career Position' : 'Add New Career Position' }}
                </h5>
                <button type="button" class="btn-close" (click)="cancelDialog()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="careerForm">
                    <!-- Basic Information -->
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="form-label">Job Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="jobTitle" 
                                [class.is-invalid]="careerForm.get('jobTitle')?.invalid && careerForm.get('jobTitle')?.touched"
                                placeholder="e.g., Senior Software Engineer" />
                            <div class="invalid-feedback" *ngIf="careerForm.get('jobTitle')?.invalid && careerForm.get('jobTitle')?.touched">
                                Job title is required (max 200 characters)
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Employment Type <span class="text-danger">*</span></label>
                            <select class="form-select" formControlName="employmentType"
                                [class.is-invalid]="careerForm.get('employmentType')?.invalid && careerForm.get('employmentType')?.touched">
                                <option *ngFor="let type of employmentTypes" [value]="type.value">
                                    {{ type.label }}
                                </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="careerForm.get('employmentType')?.invalid && careerForm.get('employmentType')?.touched">
                                Employment type is required
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <label class="form-label">Department <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="department" 
                                [class.is-invalid]="careerForm.get('department')?.invalid && careerForm.get('department')?.touched"
                                placeholder="e.g., Engineering" list="departmentList" />
                            <datalist id="departmentList">
                                <option *ngFor="let dept of departments" [value]="dept">
                            </datalist>
                            <div class="invalid-feedback" *ngIf="careerForm.get('department')?.invalid && careerForm.get('department')?.touched">
                                Department is required (max 100 characters)
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Location <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" formControlName="location" 
                                [class.is-invalid]="careerForm.get('location')?.invalid && careerForm.get('location')?.touched"
                                placeholder="e.g., New York, Remote, Hybrid" />
                            <div class="invalid-feedback" *ngIf="careerForm.get('location')?.invalid && careerForm.get('location')?.touched">
                                Location is required (max 200 characters)
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Salary Range</label>
                            <input type="text" class="form-control" formControlName="salaryRange" 
                                placeholder="e.g., $80,000 - $120,000" />
                        </div>
                    </div>

                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <label class="form-label">Application Deadline <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" formControlName="applicationDeadline"
                                [class.is-invalid]="careerForm.get('applicationDeadline')?.invalid && careerForm.get('applicationDeadline')?.touched" />
                            <div class="invalid-feedback" *ngIf="careerForm.get('applicationDeadline')?.invalid && careerForm.get('applicationDeadline')?.touched">
                                Application deadline is required
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" formControlName="isActive" id="isActiveSwitch" />
                                <label class="form-check-label" for="isActiveSwitch">
                                    Active (visible to applicants)
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mt-3">
                        <label class="form-label">Job Description <span class="text-danger">*</span></label>
                        <textarea class="form-control" formControlName="description" rows="5" 
                            [class.is-invalid]="careerForm.get('description')?.invalid && careerForm.get('description')?.touched"
                            placeholder="Provide a detailed description of the role, what the candidate will do, and the team they'll join..."></textarea>
                        <div class="invalid-feedback" *ngIf="careerForm.get('description')?.invalid && careerForm.get('description')?.touched">
                            Description is required (minimum 50 characters)
                        </div>
                        <div class="form-text" *ngIf="!careerForm.get('description')?.invalid || !careerForm.get('description')?.touched">
                            Minimum 50 characters
                        </div>
                    </div>

                    <!-- Responsibilities -->
                    <div class="mt-3">
                        <label class="form-label">Key Responsibilities</label>
                        <div class="mb-2">
                            <button type="button" class="btn-outline-primary-theme btn-theme-sm" (click)="addResponsibility()">
                                <i class="bi bi-plus-circle me-1"></i>
                                Add Responsibility
                            </button>
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-start" 
                                *ngFor="let responsibility of responsibilities; let i = index">
                                <span>{{ responsibility }}</span>
                                <button type="button" class="btn-outline-danger-theme btn-theme-sm" (click)="removeResponsibility(i)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </li>
                            <li class="list-group-item text-muted" *ngIf="responsibilities.length === 0">
                                No responsibilities added yet
                            </li>
                        </ul>
                    </div>

                    <!-- Requirements -->
                    <div class="mt-3">
                        <label class="form-label">Requirements & Qualifications</label>
                        <div class="mb-2">
                            <button type="button" class="btn-outline-primary-theme btn-theme-sm" (click)="addRequirement()">
                                <i class="bi bi-plus-circle me-1"></i>
                                Add Requirement
                            </button>
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-start" 
                                *ngFor="let requirement of requirements; let i = index">
                                <span>{{ requirement }}</span>
                                <button type="button" class="btn-outline-danger-theme btn-theme-sm" (click)="removeRequirement(i)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </li>
                            <li class="list-group-item text-muted" *ngIf="requirements.length === 0">
                                No requirements added yet
                            </li>
                        </ul>
                    </div>

                    <!-- Benefits -->
                    <div class="mt-3">
                        <label class="form-label">Benefits & Perks</label>
                        <div class="mb-2">
                            <button type="button" class="btn-outline-primary-theme btn-theme-sm" (click)="addBenefit()">
                                <i class="bi bi-plus-circle me-1"></i>
                                Add Benefit
                            </button>
                        </div>
                        <ul class="list-group">
                            <li class="list-group-item d-flex justify-content-between align-items-start" 
                                *ngFor="let benefit of benefits; let i = index">
                                <span>{{ benefit }}</span>
                                <button type="button" class="btn-outline-danger-theme btn-theme-sm" (click)="removeBenefit(i)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </li>
                            <li class="list-group-item text-muted" *ngIf="benefits.length === 0">
                                No benefits added yet
                            </li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <div class="flex-grow-1">
                    <small class="text-danger" *ngIf="careerForm.invalid">
                        <i class="bi bi-exclamation-circle me-1"></i>
                        Please fill in all required fields marked with <span class="text-danger">*</span>
                    </small>
                </div>
                <button type="button" class="btn-secondary-theme" (click)="cancelDialog()">Cancel</button>
                <button type="button" class="btn-primary-theme" (click)="saveCareer()" [disabled]="careerForm.invalid || loading">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                    {{ isEditMode ? 'Update' : 'Create' }} Position
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="displayDialog" *ngIf="displayDialog"></div>
